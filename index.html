<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Rotation Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as inline SVGs
        const Copy = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>;
        const RotateCw = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>;
        const Users = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const Settings = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/></svg>;
        const Upload = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const Download = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const BarChart3 = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>;
        const Trash2 = () => <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const ChevronRight = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>;
        const ChevronLeft = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>;
        const AlertCircle = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;
        const Calendar = () => <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;

        // Schedule configurations
        const SCHEDULES = {
            'Sun-Wed': { days: [0, 1, 2, 3], color: 'blue', label: 'Sun-Wed' },
            'Mon-Thu': { days: [1, 2, 3, 4], color: 'green', label: 'Mon-Thu' },
            'Tue-Fri': { days: [2, 3, 4, 5], color: 'yellow', label: 'Tue-Fri' },
            'Wed-Sat': { days: [3, 4, 5, 6], color: 'orange', label: 'Wed-Sat' },
            'Thu-Mon': { days: [4, 5, 6, 0, 1], color: 'red', label: 'Thu-Mon' },
            'Sat-Tue': { days: [6, 0, 1, 2], color: 'purple', label: 'Sat-Tue' },
            'Flex': { days: [0, 1, 2, 3, 4, 5, 6], color: 'gray', label: 'Flex' }
        };

        function QuickRotation() {
            const [employees, setEmployees] = useState([]);
            const [todayAssignments, setTodayAssignments] = useState({ DA: [], PS: [], Sweep: [], Expedite: [] });
            const [history, setHistory] = useState([]);
            const [currentDate, setCurrentDate] = useState(new Date().toLocaleDateString());
            const [showSetup, setShowSetup] = useState(false);
            const [showStats, setShowStats] = useState(false);
            const [bulkInput, setBulkInput] = useState('');
            const [showBulkModal, setShowBulkModal] = useState(false);
            const [showNamesList, setShowNamesList] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('rotation_employees_v2');
                if (saved) {
                    setEmployees(JSON.parse(saved));
                } else {
                    // Try to migrate old data
                    const oldSaved = localStorage.getItem('rotation_employees');
                    if (oldSaved) {
                        const oldData = JSON.parse(oldSaved);
                        // Convert old format to new format with schedules
                        if (oldData.All && Array.isArray(oldData.All)) {
                            const newEmployees = oldData.All.map(name => ({
                                name,
                                dasTrained: oldData.DA?.includes(name) || false,
                                psTrained: oldData.PS?.includes(name) || false,
                                sweepTrained: oldData.Sweep?.includes(name) || false,
                                schedule: 'Flex',
                                lastWeekRole: 'Expedite'
                            }));
                            setEmployees(newEmployees);
                        }
                    }
                }
                const savedHistory = localStorage.getItem('rotation_history');
                if (savedHistory) setHistory(JSON.parse(savedHistory));
            }, []);

            useEffect(() => {
                localStorage.setItem('rotation_employees_v2', JSON.stringify(employees));
            }, [employees]);

            useEffect(() => {
                localStorage.setItem('rotation_history', JSON.stringify(history));
            }, [history]);

            const isWorkingToday = (schedule) => {
                const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
                return SCHEDULES[schedule]?.days.includes(today) || false;
            };

            const getScheduleColor = (schedule) => {
                return SCHEDULES[schedule]?.color || 'gray';
            };

            const processBulkInput = () => {
                const lines = bulkInput.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                const newEmployees = [...employees];
                
                lines.forEach(line => {
                    const parts = line.split(/[,\t]+/).map(p => p.trim());
                    const name = parts[0];
                    if (!name) return;
                    
                    const dasTrained = parts[1] ? ['yes', 'y', 'true', '1', 'x'].includes(parts[1].toLowerCase()) : false;
                    const psTrained = parts[2] ? ['yes', 'y', 'true', '1', 'x'].includes(parts[2].toLowerCase()) : false;
                    const sweepTrained = parts[3] ? ['yes', 'y', 'true', '1', 'x'].includes(parts[3].toLowerCase()) : false;
                    const lastWeekRole = parts[4] && ['DA', 'PS', 'Sweep', 'Expedite'].includes(parts[4]) ? parts[4] : 'Expedite';
                    const schedule = parts[5] && Object.keys(SCHEDULES).includes(parts[5]) ? parts[5] : 'Flex';
                    
                    // Check if employee already exists
                    const existingIndex = newEmployees.findIndex(e => e.name === name);
                    if (existingIndex >= 0) {
                        newEmployees[existingIndex] = { name, dasTrained, psTrained, sweepTrained, lastWeekRole, schedule };
                    } else {
                        newEmployees.push({ name, dasTrained, psTrained, sweepTrained, lastWeekRole, schedule });
                    }
                });
                
                setEmployees(newEmployees);
                setBulkInput('');
                setShowBulkModal(false);
            };

            const addEmployee = () => {
                setEmployees([...employees, {
                    name: `Employee ${employees.length + 1}`,
                    dasTrained: false,
                    psTrained: false,
                    sweepTrained: false,
                    schedule: 'Flex',
                    lastWeekRole: 'Expedite'
                }]);
            };

            const removeEmployee = (name) => {
                setEmployees(employees.filter(e => e.name !== name));
            };

            const updateEmployee = (oldName, field, value) => {
                setEmployees(employees.map(emp =>
                    emp.name === oldName ? { ...emp, [field]: value } : emp
                ));
            };

            const exportEmployeesToExcel = () => {
                const data = employees.map(emp => ({
                    'Name': emp.name,
                    'DA Trained': emp.dasTrained ? 'Yes' : 'No',
                    'PS Trained': emp.psTrained ? 'Yes' : 'No',
                    'Sweep Trained': emp.sweepTrained ? 'Yes' : 'No',
                    'Schedule': emp.schedule,
                    'Last Week Role': emp.lastWeekRole
                }));
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Employees');
                XLSX.writeFile(wb, 'Employee_List_With_Schedules.xlsx');
            };

            const importEmployeesFromExcel = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const data = new Uint8Array(evt.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    const newEmployees = [];
                    jsonData.forEach(row => {
                        const name = row.Name || row.name;
                        if (name) {
                            newEmployees.push({
                                name,
                                dasTrained: row['DA Trained'] === 'Yes',
                                psTrained: row['PS Trained'] === 'Yes',
                                sweepTrained: row['Sweep Trained'] === 'Yes',
                                schedule: row.Schedule && Object.keys(SCHEDULES).includes(row.Schedule) ? row.Schedule : 'Flex',
                                lastWeekRole: row['Last Week Role'] || 'Expedite'
                            });
                        }
                    });
                    setEmployees(newEmployees);
                    alert(`âœ… Imported ${newEmployees.length} employees with schedules!`);
                };
                reader.readAsArrayBuffer(file);
            };

            const getAvailableForRole = (role) => {
                const assigned = [...todayAssignments.DA, ...todayAssignments.PS, ...todayAssignments.Sweep, ...todayAssignments.Expedite];
                let available = employees.filter(emp => !assigned.includes(emp.name) && isWorkingToday(emp.schedule));
                
                if (role === 'Expedite') return available;
                if (role === 'DA') return available.filter(emp => emp.dasTrained);
                if (role === 'PS') return available.filter(emp => emp.psTrained);
                if (role === 'Sweep') return available.filter(emp => emp.sweepTrained);
                return available;
            };

            const addToRole = (role, name) => {
                setTodayAssignments({ ...todayAssignments, [role]: [...todayAssignments[role], name] });
            };

            const removeFromRole = (role, name) => {
                setTodayAssignments({ ...todayAssignments, [role]: todayAssignments[role].filter(n => n !== name) });
            };

            const getPeopleWhoWorkedRecently = () => {
                const recentDays = history.slice(-3);
                const recentWorkers = new Set();
                recentDays.forEach(day => {
                    [...day.DA, ...day.PS, ...day.Sweep, ...day.Expedite].forEach(name => recentWorkers.add(name));
                });
                return recentWorkers;
            };

            const getSuggestedPeople = (role, count) => {
                const recentWorkers = getPeopleWhoWorkedRecently();
                const available = getAvailableForRole(role);
                const fresh = available.filter(emp => !recentWorkers.has(emp.name));
                const rested = available.filter(emp => recentWorkers.has(emp.name));
                return [...fresh, ...rested].slice(0, count).map(emp => emp.name);
            };

            const autoFill = () => {
                const suggestions = {
                    DA: getSuggestedPeople('DA', 3),
                    PS: getSuggestedPeople('PS', 1),
                    Sweep: getSuggestedPeople('Sweep', 1),
                    Expedite: getSuggestedPeople('Expedite', 2)
                };
                setTodayAssignments(suggestions);
            };

            const copyToClipboard = () => {
                const text = `Hey Team, this is our indirect for today

DAA- ${todayAssignments.DA.join(', ') || 'None'}
PS- ${todayAssignments.PS.join(', ') || 'None'}
Sweeper- ${todayAssignments.Sweep.join(', ') || 'None'}
Expedite- ${todayAssignments.Expedite.join(', ') || 'None'}

Need anything, let me know`;
                navigator.clipboard.writeText(text);
                alert('âœ… Copied to clipboard! Ready to paste in chat.');
            };

            const saveAndNext = () => {
                const newHistory = [...history, { date: currentDate, ...todayAssignments }];
                setHistory(newHistory);
                setTodayAssignments({ DA: [], PS: [], Sweep: [], Expedite: [] });
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                setCurrentDate(tomorrow.toLocaleDateString());
            };

            const clearToday = () => {
                setTodayAssignments({ DA: [], PS: [], Sweep: [], Expedite: [] });
            };

            const undoLastSave = () => {
                if (history.length === 0) { alert('No history to undo!'); return; }
                if (confirm('Undo last saved day and restore those assignments?')) {
                    const lastDay = history[history.length - 1];
                    setTodayAssignments({ DA: lastDay.DA, PS: lastDay.PS, Sweep: lastDay.Sweep, Expedite: lastDay.Expedite });
                    setCurrentDate(lastDay.date);
                    setHistory(history.slice(0, -1));
                    alert('âœ… Last day restored!');
                }
            };

            const getScheduledToday = () => {
                return employees.filter(emp => isWorkingToday(emp.schedule));
            };

            const roleConfigs = [
                { key: 'DA', label: 'DAA', color: 'blue', required: 2, extra: 1 },
                { key: 'PS', label: 'PS', color: 'purple', required: 1, extra: 0 },
                { key: 'Sweep', label: 'Sweeper', color: 'green', required: 1, extra: 0 },
                { key: 'Expedite', label: 'Expedite', color: 'orange', required: 1, extra: 1 }
            ];

            if (showSetup) {
                return (
                    <div className="min-h-screen bg-gray-50 p-6">
                        <div className="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold">Employee Setup with Schedules</h2>
                                <div className="flex gap-2">
                                    <label className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 cursor-pointer flex items-center gap-2">
                                        <Upload /> Import Excel
                                        <input type="file" accept=".xlsx,.xls" onChange={importEmployeesFromExcel} className="hidden" />
                                    </label>
                                    <button onClick={exportEmployeesToExcel} className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2">
                                        <Download /> Export Excel
                                    </button>
                                    <button onClick={() => setShowSetup(false)} className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Back</button>
                                </div>
                            </div>

                            {showBulkModal && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                    <div className="bg-white rounded-lg shadow-xl max-w-3xl w-full p-6 max-h-[90vh] overflow-y-auto">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-xl font-bold">Bulk Add Employees</h3>
                                            <button onClick={() => setShowBulkModal(false)} className="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                                        </div>
                                        <div className="mb-4 bg-blue-50 p-4 rounded">
                                            <p className="text-sm text-blue-800 font-semibold mb-2">Format: Name, DA, PS, Sweep, LastWeek, Schedule</p>
                                            <div className="text-sm text-blue-700 font-mono bg-white p-3 rounded space-y-1">
                                                <div>Marcus Thompson, yes, yes, no, DA, Sun-Wed</div>
                                                <div>Elena Rodriguez, yes, no, yes, Sweep, Flex</div>
                                                <div>Kevin Patterson, yes, yes, no, PS, Mon-Thu</div>
                                            </div>
                                            <p className="text-xs text-blue-600 mt-2">
                                                Schedules: Sun-Wed, Mon-Thu, Tue-Fri, Wed-Sat, Thu-Mon, Sat-Tue, Flex
                                            </p>
                                        </div>
                                        <textarea
                                            value={bulkInput}
                                            onChange={(e) => setBulkInput(e.target.value)}
                                            placeholder="Enter one employee per line"
                                            className="w-full h-64 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                                        />
                                        <div className="flex gap-3 mt-4">
                                            <button onClick={processBulkInput} className="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 font-semibold">
                                                Add {bulkInput.split('\n').filter(l => l.trim()).length} Employees
                                            </button>
                                            <button onClick={() => setShowBulkModal(false)} className="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold">
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="mb-6">
                                <button
                                    onClick={() => setShowBulkModal(true)}
                                    className="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 flex items-center gap-2 mb-4"
                                >
                                    <Upload /> Bulk Add Employees
                                </button>
                                <button
                                    onClick={addEmployee}
                                    className="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 flex items-center gap-2"
                                >
                                    <Users /> Add One Employee
                                </button>
                            </div>

                            <div className="bg-gray-50 rounded-lg p-4 mb-6">
                                <h3 className="font-semibold mb-3">Employee List ({employees.length} total)</h3>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-100">
                                            <tr>
                                                <th className="px-4 py-2 text-left">Name</th>
                                                <th className="px-4 py-2 text-center">DA</th>
                                                <th className="px-4 py-2 text-center">PS</th>
                                                <th className="px-4 py-2 text-center">Sweep</th>
                                                <th className="px-4 py-2 text-left">Schedule</th>
                                                <th className="px-4 py-2 text-left">Last Week</th>
                                                <th className="px-4 py-2 text-center">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {employees.map((emp, idx) => (
                                                <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                    <td className="px-4 py-2">
                                                        <input
                                                            type="text"
                                                            value={emp.name}
                                                            onChange={(e) => updateEmployee(emp.name, 'name', e.target.value)}
                                                            className="w-full px-2 py-1 border rounded text-sm"
                                                        />
                                                    </td>
                                                    <td className="px-4 py-2 text-center">
                                                        <input
                                                            type="checkbox"
                                                            checked={emp.dasTrained}
                                                            onChange={(e) => updateEmployee(emp.name, 'dasTrained', e.target.checked)}
                                                            className="w-4 h-4"
                                                        />
                                                    </td>
                                                    <td className="px-4 py-2 text-center">
                                                        <input
                                                            type="checkbox"
                                                            checked={emp.psTrained}
                                                            onChange={(e) => updateEmployee(emp.name, 'psTrained', e.target.checked)}
                                                            className="w-4 h-4"
                                                        />
                                                    </td>
                                                    <td className="px-4 py-2 text-center">
                                                        <input
                                                            type="checkbox"
                                                            checked={emp.sweepTrained}
                                                            onChange={(e) => updateEmployee(emp.name, 'sweepTrained', e.target.checked)}
                                                            className="w-4 h-4"
                                                        />
                                                    </td>
                                                    <td className="px-4 py-2">
                                                        <select
                                                            value={emp.schedule}
                                                            onChange={(e) => updateEmployee(emp.name, 'schedule', e.target.value)}
                                                            className="w-full px-2 py-1 border rounded text-sm"
                                                        >
                                                            {Object.keys(SCHEDULES).map(sched => (
                                                                <option key={sched} value={sched}>{sched}</option>
                                                            ))}
                                                        </select>
                                                    </td>
                                                    <td className="px-4 py-2">
                                                        <select
                                                            value={emp.lastWeekRole}
                                                            onChange={(e) => updateEmployee(emp.name, 'lastWeekRole', e.target.value)}
                                                            className="w-full px-2 py-1 border rounded text-sm"
                                                        >
                                                            <option value="DA">DA</option>
                                                            <option value="PS">PS</option>
                                                            <option value="Sweep">Sweep</option>
                                                            <option value="Expedite">Expedite</option>
                                                        </select>
                                                    </td>
                                                    <td className="px-4 py-2 text-center">
                                                        <button
                                                            onClick={() => removeEmployee(emp.name)}
                                                            className="text-red-500 hover:text-red-700"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div className="bg-blue-50 border border-blue-300 rounded-lg p-4">
                                <p className="text-sm text-blue-800">
                                    <strong>ðŸ’¡ Schedule Info:</strong> Auto-Fill will only show people scheduled to work today. Flex employees are available every day.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-50 to-blue-50 p-6">
                    <div className="max-w-4xl mx-auto bg-white rounded-lg shadow-xl p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-3xl font-bold flex items-center gap-2">
                                    <RotateCw /> Quick Rotation
                                </h1>
                                <p className="text-gray-600 mt-1">{currentDate}</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowSetup(true)} className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 flex items-center gap-2">
                                    <Settings /> Setup
                                </button>
                            </div>
                        </div>

                        {employees.length === 0 ? (
                            <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-6 text-center">
                                <div className="flex justify-center mb-4"><Users /></div>
                                <h3 className="text-xl font-semibold text-gray-800 mb-2">No Employees Added Yet</h3>
                                <p className="text-gray-600 mb-4">Click "Setup" to add your team with schedules</p>
                                <button onClick={() => setShowSetup(true)} className="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                                    Setup Now
                                </button>
                            </div>
                        ) : (
                            <>
                                <div className="mb-6 bg-gradient-to-r from-blue-50 to-green-50 border-2 border-blue-200 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className="font-bold text-lg text-gray-800">Today's Coverage</div>
                                            <div className="text-sm text-gray-600">{getScheduledToday().length} people scheduled to work today</div>
                                        </div>
                                        <div className="flex gap-2">
                                            {Object.entries(SCHEDULES).map(([key, config]) => {
                                                const count = getScheduledToday().filter(emp => emp.schedule === key).length;
                                                if (count === 0) return null;
                                                return (
                                                    <div key={key} className={`bg-${config.color}-100 border border-${config.color}-300 px-3 py-1 rounded`}>
                                                        <div className="text-xs font-semibold text-${config.color}-700">{key}</div>
                                                        <div className="text-lg font-bold text-${config.color}-800">{count}</div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-4 gap-3 mb-6">
                                    <div className="bg-blue-50 p-3 rounded-lg border border-blue-300 text-center">
                                        <div className="text-2xl font-bold text-blue-700">{getScheduledToday().filter(e => e.dasTrained).length}</div>
                                        <div className="text-xs text-blue-600">DA Available</div>
                                    </div>
                                    <div className="bg-purple-50 p-3 rounded-lg border border-purple-300 text-center">
                                        <div className="text-2xl font-bold text-purple-700">{getScheduledToday().filter(e => e.psTrained).length}</div>
                                        <div className="text-xs text-purple-600">PS Available</div>
                                    </div>
                                    <div className="bg-green-50 p-3 rounded-lg border border-green-300 text-center">
                                        <div className="text-2xl font-bold text-green-700">{getScheduledToday().filter(e => e.sweepTrained).length}</div>
                                        <div className="text-xs text-green-600">Sweep Available</div>
                                    </div>
                                    <div className="bg-orange-50 p-3 rounded-lg border border-orange-300 text-center">
                                        <div className="text-2xl font-bold text-orange-700">{getScheduledToday().length}</div>
                                        <div className="text-xs text-orange-600">Total Today</div>
                                    </div>
                                </div>

                                <div className="flex gap-3 mb-6">
                                    <button onClick={autoFill} className="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 font-semibold flex items-center justify-center gap-2">
                                        <RotateCw /> Auto-Fill (Smart Rotation)
                                    </button>
                                    <button onClick={clearToday} className="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600">Clear</button>
                                    {history.length > 0 && (
                                        <button onClick={undoLastSave} className="bg-yellow-500 text-white px-6 py-3 rounded-lg hover:bg-yellow-600 flex items-center gap-2">
                                            <ChevronLeft /> Undo
                                        </button>
                                    )}
                                </div>

                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    {roleConfigs.map(({ key, label, color, required, extra }) => {
                                        const currentCount = todayAssignments[key].length;
                                        const isComplete = currentCount >= required;

                                        return (
                                            <div key={key} className={`bg-${color}-50 border-2 border-${color}-300 rounded-lg p-4`}>
                                                <div className="flex justify-between items-center mb-3">
                                                    <h3 className={`font-bold text-${color}-700 text-lg`}>{label}</h3>
                                                    <div className="text-right">
                                                        <div className={`text-sm font-semibold ${isComplete ? 'text-green-600' : 'text-red-600'}`}>
                                                            {currentCount}/{required} required
                                                        </div>
                                                        {extra > 0 && <div className="text-xs text-gray-600">+{extra} extra OK</div>}
                                                    </div>
                                                </div>

                                                <div className="space-y-2 mb-3">
                                                    {todayAssignments[key].map((name, idx) => {
                                                        const isRequired = idx < required;
                                                        const isExtraAllowed = idx >= required && idx < required + extra;
                                                        const isTooMany = idx >= required + extra;
                                                        const emp = employees.find(e => e.name === name);
                                                        const schedColor = emp ? getScheduleColor(emp.schedule) : 'gray';

                                                        return (
                                                            <div key={idx} className={`rounded p-2 flex justify-between items-center border ${
                                                                isRequired ? `bg-${color}-100 border-${color}-300` :
                                                                isExtraAllowed ? `bg-white border-${color}-200` :
                                                                'bg-red-50 border-red-300'
                                                            }`}>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="font-medium text-sm">{name}</span>
                                                                    <span className={`text-xs bg-${schedColor}-100 text-${schedColor}-700 px-2 py-0.5 rounded`}>
                                                                        {emp?.schedule || 'N/A'}
                                                                    </span>
                                                                    {isRequired && <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">Required</span>}
                                                                    {isExtraAllowed && <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">Extra</span>}
                                                                    {isTooMany && <span className="text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded">Too Many!</span>}
                                                                </div>
                                                                <button onClick={() => removeFromRole(key, name)} className="text-red-500 hover:text-red-700">
                                                                    <Trash2 />
                                                                </button>
                                                            </div>
                                                        );
                                                    })}
                                                </div>

                                                <div className="relative">
                                                    <button
                                                        onClick={() => setShowNamesList(showNamesList === key ? null : key)}
                                                        className={`w-full bg-${color}-500 text-white py-2 rounded hover:bg-${color}-600 text-sm font-semibold`}
                                                    >
                                                        + Add Person ({getAvailableForRole(key).length} available)
                                                    </button>

                                                    {showNamesList === key && (
                                                        <div className="absolute z-10 w-full mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto">
                                                            {getAvailableForRole(key).map((emp, idx) => {
                                                                const recentWorkers = getPeopleWhoWorkedRecently();
                                                                const isRested = !recentWorkers.has(emp.name);
                                                                const schedColor = getScheduleColor(emp.schedule);

                                                                return (
                                                                    <button
                                                                        key={idx}
                                                                        onClick={() => {
                                                                            addToRole(key, emp.name);
                                                                            setShowNamesList(null);
                                                                        }}
                                                                        className="w-full text-left px-4 py-2 hover:bg-gray-100 border-b last:border-b-0 flex justify-between items-center"
                                                                    >
                                                                        <div className="flex items-center gap-2">
                                                                            <span>{emp.name}</span>
                                                                            <span className={`text-xs bg-${schedColor}-100 text-${schedColor}-700 px-2 py-0.5 rounded`}>
                                                                                {emp.schedule}
                                                                            </span>
                                                                        </div>
                                                                        {isRested && <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">Fresh</span>}
                                                                    </button>
                                                                );
                                                            })}
                                                            {getAvailableForRole(key).length === 0 && (
                                                                <div className="px-4 py-3 text-gray-500 text-sm italic">No one scheduled today</div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                <div className="flex gap-3 mb-6">
                                    <button onClick={copyToClipboard} className="flex-1 bg-green-500 text-white py-4 rounded-lg hover:bg-green-600 font-bold text-lg flex items-center justify-center gap-2">
                                        <Copy /> Copy for Chat
                                    </button>
                                    <button onClick={saveAndNext} className="flex-1 bg-orange-500 text-white py-4 rounded-lg hover:bg-orange-600 font-bold text-lg flex items-center justify-center gap-2">
                                        <ChevronRight /> Save & Next Day
                                    </button>
                                </div>

                                {history.length > 0 && (
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <h3 className="font-semibold text-gray-700 mb-3">Recent History (Last 3 Days)</h3>
                                        <div className="space-y-2">
                                            {history.slice(-3).reverse().map((day, idx) => (
                                                <div key={idx} className="bg-white p-3 rounded border text-sm">
                                                    <div className="font-semibold text-gray-700 mb-1">{day.date}</div>
                                                    <div className="text-gray-600">
                                                        <span className="text-blue-600">DA: {day.DA.join(', ') || 'None'}</span> â€¢
                                                        <span className="text-purple-600"> PS: {day.PS.join(', ') || 'None'}</span> â€¢
                                                        <span className="text-green-600"> Sweep: {day.Sweep.join(', ') || 'None'}</span> â€¢
                                                        <span className="text-orange-600"> Expedite: {day.Expedite.join(', ') || 'None'}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<QuickRotation />, document.getElementById('root'));
    </script>
</body>
</html>
